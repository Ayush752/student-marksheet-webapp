<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cosmic Engine - All In One</title>
<style>
body{margin:0;overflow:hidden;background:black;color:white;font-family:monospace}
#hud{
position:fixed;
top:10px;
left:10px;
z-index:10;
color:#00f5ff;
}
</style>
</head>
<body>

<div id="hud">
COSMIC ENGINE ONLINE<br>
WASD Move | Mouse Look | VR Ready
</div>

<script type="module">
import * as THREE from 'https://cdn.skypack.dev/three@0.128.0';
import { VRButton } from 'https://cdn.skypack.dev/three@0.128.0/examples/jsm/webxr/VRButton.js';

let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 5000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.xr.enabled = true;
document.body.appendChild(renderer.domElement);
document.body.appendChild(VRButton.createButton(renderer));

/* LIGHT */
let light = new THREE.PointLight(0xffffff,2);
light.position.set(50,50,50);
scene.add(light);

/* STARFIELD */
const starGeo = new THREE.BufferGeometry();
const starCount = 8000;
const positions = new Float32Array(starCount*3);

for(let i=0;i<starCount*3;i++){
positions[i] = (Math.random()-0.5)*3000;
}

starGeo.setAttribute('position', new THREE.BufferAttribute(positions,3));
const starMat = new THREE.PointsMaterial({color:0x00f5ff,size:1});
const stars = new THREE.Points(starGeo,starMat);
scene.add(stars);

/* PROCEDURAL SOLAR SYSTEM */
let planets = [];

function createSolarSystem(){
const sun = new THREE.Mesh(
new THREE.SphereGeometry(20,32,32),
new THREE.MeshBasicMaterial({color:0xffff00})
);
scene.add(sun);

for(let i=0;i<6;i++){
let distance = 60 + i*40;
let size = Math.random()*5+5;

let planet = new THREE.Mesh(
new THREE.SphereGeometry(size,32,32),
new THREE.MeshStandardMaterial({
color:new THREE.Color(Math.random(),Math.random(),Math.random())
})
);

planet.userData = {
distance:distance,
angle:Math.random()*Math.PI*2,
speed:0.001+Math.random()*0.002
};

planets.push(planet);
scene.add(planet);
}
}

createSolarSystem();

/* AI NPC */
class NPC{
constructor(position){
this.mesh = new THREE.Mesh(
new THREE.SphereGeometry(5,32,32),
new THREE.MeshStandardMaterial({color:0xff00ff})
);
this.mesh.position.copy(position);
scene.add(this.mesh);
}

update(playerPos){
let direction = playerPos.clone().sub(this.mesh.position);
direction.normalize();
this.mesh.position.add(direction.multiplyScalar(0.1));
}
}

let npc = new NPC(new THREE.Vector3(100,0,-200));

/* PLAYER CONTROLS */
let move = {w:false,s:false,a:false,d:false};
let velocity = new THREE.Vector3();

document.body.addEventListener("click",()=>document.body.requestPointerLock());

document.addEventListener("mousemove",(e)=>{
if(document.pointerLockElement===document.body){
camera.rotation.y -= e.movementX*0.002;
camera.rotation.x -= e.movementY*0.002;
}
});

document.addEventListener("keydown",(e)=>move[e.key.toLowerCase()]=true);
document.addEventListener("keyup",(e)=>move[e.key.toLowerCase()]=false);

camera.position.z = 100;

/* MULTIPLAYER STUB */
function sendPlayerState(){
const state = {
x:camera.position.x,
y:camera.position.y,
z:camera.position.z
};
// Replace with WebSocket send later
console.log("Sending player state",state);
}

/* ENGINE LOOP */
function animate(){
renderer.setAnimationLoop(render);
}

function render(){

velocity.set(0,0,0);
if(move.w) velocity.z -= 1;
if(move.s) velocity.z += 1;
if(move.a) velocity.x -= 1;
if(move.d) velocity.x += 1;

camera.translateX(velocity.x);
camera.translateZ(velocity.z);

/* Planet Orbit */
planets.forEach(p=>{
p.userData.angle += p.userData.speed;
p.position.x = Math.cos(p.userData.angle)*p.userData.distance;
p.position.z = Math.sin(p.userData.angle)*p.userData.distance;
});

/* NPC AI */
npc.update(camera.position);

/* Rotate stars */
stars.rotation.y += 0.0005;

/* Simulated Multiplayer */
sendPlayerState();

renderer.render(scene,camera);
}

animate();

/* RESPONSIVE */
window.addEventListener("resize",()=>{
camera.aspect = window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
