<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INTERACTIVE COSMIC VR UNIVERSE</title>
<style>
body{margin:0; overflow:hidden; font-family:'Orbitron',sans-serif; background:black; color:white;}
#hud{position:fixed;top:20px;left:20px;z-index:10;color:#00f5ff;font-family:monospace;}
button#toggleBtn{
  position:fixed;top:20px;right:20px;z-index:11;padding:10px 20px;border:none;border-radius:30px;cursor:pointer;background:#00f5ff;color:#000;font-weight:bold;
}
</style>
</head>
<body>
<div id="hud">ü™ê COSMIC VR UNIVERSE - WASD/Mouse | Click to Lock Pointer | VR Ready</div>
<button id="toggleBtn">Toggle Light Mode</button>

<script type="module">
// Import Three.js + extras
import * as THREE from 'https://cdn.skypack.dev/three@0.128.0';
import { VRButton } from 'https://cdn.skypack.dev/three@0.128.0/examples/jsm/webxr/VRButton.js';
import { XRControllerModelFactory } from 'https://cdn.skypack.dev/three@0.128.0/examples/jsm/webxr/XRControllerModelFactory.js';
import { OrbitControls } from 'https://cdn.skypack.dev/three@0.128.0/examples/jsm/controls/OrbitControls.js';

// --- Scene & Camera ---
const scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x000000,0.002);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 5000);
camera.position.set(0,50,150);

// --- Renderer ---
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.xr.enabled = true;
document.body.appendChild(renderer.domElement);
document.body.appendChild(VRButton.createButton(renderer));

// --- Lights ---
const light = new THREE.PointLight(0xffffff,2);
light.position.set(100,200,100);
scene.add(light);

// --- Starfield ---
const starGeo = new THREE.BufferGeometry();
const starCount=20000;
const positions=new Float32Array(starCount*3);
for(let i=0;i<starCount*3;i++){positions[i]=(Math.random()-0.5)*4000;}
starGeo.setAttribute('position', new THREE.BufferAttribute(positions,3));
const stars=new THREE.Points(starGeo,new THREE.PointsMaterial({color:0xffffff,size:1}));
scene.add(stars);

// --- Planets ---
const planets=[];
function createPlanet(color,size,distance,speed,moons=0){
  const geo = new THREE.SphereGeometry(size,32,32);
  const mat = new THREE.MeshStandardMaterial({color:color,emissive:color,emissiveIntensity:0.3});
  const mesh = new THREE.Mesh(geo,mat);
  mesh.userData={distance,speed,angle:Math.random()*Math.PI*2,moons:[]};
  mesh.position.set(distance,0,0);
  scene.add(mesh);
  // Moons
  for(let i=0;i<moons;i++){
    const mGeo = new THREE.SphereGeometry(size*0.3,16,16);
    const mMat = new THREE.MeshStandardMaterial({color:0x888888,emissive:0x555555});
    const moon = new THREE.Mesh(mGeo,mMat);
    moon.userData={angle:Math.random()*Math.PI*2,speed:0.02+Math.random()*0.01,distance:size*2+i*5};
    mesh.add(moon);
    mesh.userData.moons.push(moon);
  }
  planets.push(mesh);
}
createPlanet(0xffaa00,20,0,0); // sun
createPlanet(0x00aaff,8,60,0.01,1);
createPlanet(0xff00ff,6,100,0.008,2);
createPlanet(0x00ff88,5,140,0.006,1);

// --- NPC Spaceships ---
const npcShips=[];
function createShip(color,x,y,z){
  const geo = new THREE.ConeGeometry(2,6,8);
  const mat = new THREE.MeshStandardMaterial({color:color,emissive:color});
  const ship = new THREE.Mesh(geo,mat);
  ship.position.set(x,y,z);
  ship.rotation.x=Math.PI/2;
  ship.userData={direction:new THREE.Vector3(Math.random()-0.5,Math.random()-0.1,Math.random()-0.5).normalize()};
  scene.add(ship);
  npcShips.push(ship);
}
for(let i=0;i<5;i++){createShip(0xff00ff,(Math.random()-0.5)*400,(Math.random()-0.5)*200,(Math.random()-0.5)*400);}

// --- Controls ---
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping=true;
controls.dampingFactor=0.05;
controls.enablePan=false;
controls.minDistance=50;
controls.maxDistance=500;

// --- FPS Movement ---
let move={w:false,s:false,a:false,d:false};
document.body.addEventListener("click",()=>document.body.requestPointerLock());
document.addEventListener("mousemove",(e)=>{
  if(document.pointerLockElement===document.body){
    camera.rotation.y-=e.movementX*0.002;
    camera.rotation.x-=e.movementY*0.002;
  }
});
document.addEventListener("keydown",(e)=>{move[e.key.toLowerCase()]=true;});
document.addEventListener("keyup",(e)=>{move[e.key.toLowerCase()]=false;});

// --- VR Controllers ---
const controller1 = renderer.xr.getController(0);
const controller2 = renderer.xr.getController(1);
scene.add(controller1);
scene.add(controller2);

const controllerModelFactory = new XRControllerModelFactory();
const c1Grip = renderer.xr.getControllerGrip(0);
c1Grip.add(controllerModelFactory.createControllerModel(c1Grip));
scene.add(c1Grip);
const c2Grip = renderer.xr.getControllerGrip(1);
c2Grip.add(controllerModelFactory.createControllerModel(c2Grip));
scene.add(c2Grip);

// --- Animate ---
function animate(){
  renderer.setAnimationLoop(render);
}
function render(){
  const speed=1;
  if(move.w) camera.translateZ(-speed);
  if(move.s) camera.translateZ(speed);
  if(move.a) camera.translateX(-speed);
  if(move.d) camera.translateX(speed);

  // Planet orbit
  planets.forEach(p=>{
    p.userData.angle+=p.userData.speed;
    p.position.x = Math.cos(p.userData.angle)*p.userData.distance;
    p.position.z = Math.sin(p.userData.angle)*p.userData.distance;
    p.userData.moons.forEach(m=>{
      m.userData.angle+=m.userData.speed;
      m.position.x = Math.cos(m.userData.angle)*m.userData.distance;
      m.position.z = Math.sin(m.userData.angle)*m.userData.distance;
    });
  });

  // NPC ship movement
  npcShips.forEach(ship=>{
    ship.position.add(ship.userData.direction);
    // Simple bounds
    if(ship.position.length()>400) ship.userData.direction.multiplyScalar(-1);
  });

  // Rotate stars slightly
  stars.rotation.y += 0.0005;

  controls.update();
  renderer.render(scene,camera);
}
animate();

// --- Responsive ---
window.addEventListener("resize",()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

// --- Dark / Light Mode ---
const toggleBtn = document.getElementById('toggleBtn');
toggleBtn.addEventListener('click',()=>{
  if(document.body.style.background=='black'){
    document.body.style.background='white';
  }else{
    document.body.style.background='black';
  }
});
</script>
</body>
</html>
